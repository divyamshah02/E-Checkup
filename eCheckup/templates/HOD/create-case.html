<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Case - eCheckup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/universal-theme.css" rel="stylesheet">
    <link href="/static/css/HOD/create-case.css" rel="stylesheet">
    <style>
        /* Custom validation styles */
        .invalid-feedback {
            display: none;
        }
        
        .is-invalid ~ .invalid-feedback,
        .was-validated .form-control:invalid ~ .invalid-feedback,
        .was-validated .form-select:invalid ~ .invalid-feedback {
            display: block;
        }
        
        /* Case type validation */
        .case-type-validation-error {
            display: none;
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 0.25rem;
        }
        
        .case-type-validation-error.show {
            display: block;
        }
    </style>
</head>
<body>
<div class="sidebar-backdrop" id="sidebarBackdrop"></div>

    <div class="w-100 px-1 px-md-0 mx-auto">
        <!-- Sidebar -->
        {% include 'HOD/nav.html' %}

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="content-header">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                    <div>
                        <h1 class="page-title">Create New Case</h1>
                        <p class="page-subtitle">Set up a new medical examination case</p>
                    </div>                    
                </div>
            </div>
            <!-- Content Body -->
            <div class="content-body">
                <!-- Progress Indicator -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="progress-container">
                            <div class="progress mb-3" style="height: 8px;">
                                <div class="progress-bar bg-primary" role="progressbar" style="width: 33%" id="progressBar"></div>
                            </div>
                            <div class="d-flex justify-content-between">
                                <div class="step-indicator active" data-step="1">
                                    <div class="step-circle">1</div>
                                    <small class="d-block mt-2">Case Details</small>
                                </div>
                                <div class="step-indicator" data-step="2">
                                    <div class="step-circle">2</div>
                                    <small class="d-block mt-2">Assignment</small>
                                </div>
                                <div class="step-indicator" data-step="3">
                                    <div class="step-circle">3</div>
                                    <small class="d-block mt-2">Review</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <form id="caseCreationForm" class="needs-validation" novalidate>
                    <!-- Step 1: Case & Policy Details -->
                    <div class="step-content" id="step1">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-file-medical me-2 text-primary"></i>
                                    Case & Policy Details
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Case Type Selection -->
                                <div class="mb-4">
                                    <label class="form-label fw-semibold mb-3">
                                        Select Medical Examination Type <span class="text-danger">*</span>
                                    </label>
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="case-type-card" data-type="vmer">
                                                <div class="case-type-icon bg-info text-white">
                                                    <i class="fas fa-video fa-2x"></i>
                                                </div>
                                                <div class="case-type-content">
                                                    <h6 class="fw-semibold">VMER</h6>
                                                    <p class="text-muted small mb-2">Video Medical Examination Report</p>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="caseType" id="vmerType" value="vmer" required>
                                                        <label class="form-check-label fw-medium" for="vmerType">Select VMER</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="case-type-card" data-type="dc-visit">
                                                <div class="case-type-icon bg-success text-white">
                                                    <i class="fas fa-hospital-user fa-2x"></i>
                                                </div>
                                                <div class="case-type-content">
                                                    <h6 class="fw-semibold">New business cases</h6>
                                                    <p class="text-muted small mb-2">Diagnostic Center Visit</p>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="caseType" id="dcType" value="dc-visit" required>
                                                        <label class="form-check-label fw-medium" for="dcType">Select DC Visit</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="case-type-card" data-type="online">
                                                <div class="case-type-icon bg-warning text-white">
                                                    <i class="fas fa-laptop-medical fa-2x"></i>
                                                </div>
                                                <div class="case-type-content">
                                                    <h6 class="fw-semibold">Online</h6>
                                                    <p class="text-muted small mb-2">Online Consultation</p>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="caseType" id="onlineType" value="online" required>
                                                        <label class="form-check-label fw-medium" for="onlineType">Select Online</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="case-type-card" data-type="both">
                                                <div class="case-type-icon bg-danger text-white">
                                                    <i class="fas fa-hospital-user fa-2x"></i>
                                                </div>
                                                <div class="case-type-content">
                                                    <h6 class="fw-semibold">Both</h6>
                                                    <p class="text-muted small mb-2">VMER & DC Visit</p>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="radio" name="caseType" id="bothType" value="both" required>
                                                        <label class="form-check-label fw-medium" for="bothType">Select Both</label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="case-type-validation-error" id="caseTypeError">
                                        Please select a medical examination type.
                                    </div>
                                </div>

                                <hr class="my-4">

                                <!-- Policy Details -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="policyType" class="form-label fw-semibold">
                                            Policy Type <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="policyType" required>
                                            <option value="">Select policy type</option>
                                            <option value="revival">Policy Revival</option>
                                            <option value="new">New Policy</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a policy type.</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="policyNumber" id="policyNumberLabel" class="form-label fw-semibold">
                                            Policy Number <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="policyNumber" placeholder="Enter number" required>
                                        <div class="invalid-feedback">Please enter a valid policy number.</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="holderName" class="form-label fw-semibold">
                                            Policy Holder Name <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="holderName" placeholder="Enter full name" required>
                                        <div class="invalid-feedback">Please enter the policy holder's name.</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="holderPhone" class="form-label fw-semibold">
                                            Phone Number <span class="text-danger">*</span>
                                        </label>
                                        <input type="tel" class="form-control" id="holderPhone" placeholder="+91 9876543210" required>
                                        <div class="invalid-feedback">Please enter a valid phone number.</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <label for="holderEmail" class="form-label fw-semibold">
                                            Email Address
                                        </label>
                                        <input type="email" class="form-control" id="holderEmail" required placeholder="Enter email address">
                                        <div class="invalid-feedback">Please enter a valid email address.</div>
                                    </div>                                    
                                </div>

                                <!-- New Policy Holder and LIC Details Section -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="licGstNo" class="form-label fw-semibold">
                                            LIC GST Number
                                        </label>
                                        <input type="text" class="form-control" id="licGstNo" placeholder="Enter LIC GST number">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="licType" class="form-label fw-semibold">
                                            LIC Type
                                        </label>
                                        <select class="form-select" id="licType">
                                            <option value="">Select LIC type</option>
                                            <option value="urban">Urban</option>
                                            <option value="rural">Rural</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="intimationDate" class="form-label fw-semibold">
                                            Intimation Date
                                        </label>
                                        <input type="date" class="form-control" id="intimationDate">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="holderDob" class="form-label fw-semibold">
                                            Policy Holder Date of Birth
                                        </label>
                                        <input type="date" class="form-control" id="holderDob">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="holderGender" class="form-label fw-semibold">
                                            Policy Holder Gender
                                        </label>
                                        <select class="form-select" id="holderGender">
                                            <option value="">Select gender</option>
                                            <option value="M">Male</option>
                                            <option value="F">Female</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="holderAddress" class="form-label fw-semibold">
                                            Policy Holder Address
                                        </label>
                                        <textarea class="form-control" id="holderAddress" rows="3" placeholder="Enter complete address"></textarea>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="holderState" class="form-label fw-semibold">
                                            State
                                        </label>
                                        <input type="text" class="form-control" id="holderState" placeholder="Enter state">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="holderCity" class="form-label fw-semibold">
                                            City
                                        </label>
                                        <input type="text" class="form-control" id="holderCity" placeholder="Enter city">
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="holderPincode" class="form-label fw-semibold">
                                            Pincode
                                        </label>
                                        <input type="text" class="form-control" id="holderPincode" placeholder="Enter pincode" maxlength="10">
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="proposedSumInsured" class="form-label fw-semibold">
                                            Proposed Sum Insured
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text">₹</span>
                                            <input type="text" class="form-control" id="proposedSumInsured" placeholder="Enter proposed amount">
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="sumInsuredUnderConsideration" class="form-label fw-semibold">
                                            Sum Insured Under Consideration
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-text">₹</span>
                                            <input type="text" class="form-control" id="sumInsuredUnderConsideration" placeholder="Enter consideration amount">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-12 mb-4">
                                        <label class="form-label fw-semibold">
                                            Required Tests
                                        </label>
                                        <!-- Replaced test selection section with modal button -->
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="row align-items-center mb-3">
                                                    <!-- Left text -->
                                                    <div class="col-12 col-md-6 mb-2 mb-md-0">
                                                        <span class="text-muted">Select the required tests for this case</span>
                                                    </div>

                                                    <!-- Right button -->
                                                    <div class="col-12 col-md-6 text-md-end text-start">
                                                        <button type="button" class="btn btn-sm btn-outline-primary w-100 w-md-auto" id="refreshTests">
                                                            <i class="fas fa-sync-alt me-1"></i>Refresh Tests
                                                        </button>
                                                    </div>
                                                </div>

                                                <div class="text-center">
                                                    <button type="button" class="btn btn-primary btn-lg" id="selectTestsBtn" data-bs-toggle="modal" data-bs-target="#testsModal">
                                                        <i class="fas fa-plus-circle me-2"></i>
                                                        <span id="selectTestsBtnText">Select Tests</span>
                                                        <span id="selectedTestsBadge" class="badge bg-success ms-2 d-none">0</span>
                                                    </button>
                                                </div>
                                                <div class="mt-3" id="selectedTestsPreview" style="display: none;">
                                                    <small class="text-muted">
                                                        <strong>Selected Tests:</strong>
                                                    </small>
                                                    <div id="selectedTestsList" class="mt-2"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="paymentMethod" class="form-label fw-semibold">
                                            Payment Method <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="paymentMethod" required>
                                            <option value="">Select payment method</option>
                                            <option value="lic">Paid by LIC</option>
                                            <option value="self">Self Paid</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a payment method.</div>
                                    </div>
                                </div>

                                <hr class="my-4">

                                <!-- DC Visit Specific Fields -->
                                <!-- <div id="dcVisitFields" class="d-none">
                                    <hr class="my-4">
                                    <h6 class="fw-semibold mb-3">DC Visit Details</h6>
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="paymentMethod" class="form-label fw-semibold">
                                                Payment Method <span class="text-danger">*</span>
                                            </label>
                                            <select class="form-select" id="paymentMethod">
                                                <option value="">Select payment method</option>
                                                <option value="lic-paid">Paid by LIC</option>
                                                <option value="self-paid">Self Paid</option>
                                            </select>
                                            <div class="invalid-feedback">Please select a payment method.</div>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="preferredDC" class="form-label fw-semibold">
                                                Preferred DC
                                            </label>
                                            <select class="form-select" id="preferredDC">
                                                <option value="">Select diagnostic center</option>
                                                <option value="apollo-andheri">Apollo Diagnostics - Andheri</option>
                                                <option value="metropolis-bandra">Metropolis - Bandra</option>
                                                <option value="dr-lal-mumbai">Dr. Lal PathLabs - Mumbai</option>
                                            </select>
                                        </div>
                                    </div>
                                </div> -->
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Assignment -->
                    <div class="step-content d-none" id="step2">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-users me-2 text-primary"></i>
                                    Assignment Details
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- LIC Office Hierarchy -->
                                <h6 class="fw-semibold mb-3">LIC Office Hierarchy</h6>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label for="regionalOffice" class="form-label fw-semibold">
                                            Regional Office <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="regionalOffice" required>
                                            <option value="">Select regional office</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a regional office.</div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="divisionalOffice" class="form-label fw-semibold">
                                            Divisional Office <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="divisionalOffice" required disabled>
                                            <option value="">Select divisional office</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a divisional office.</div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <label for="branchOffice" class="form-label fw-semibold">
                                            Branch Office <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="branchOffice" required disabled>
                                            <option value="">Select branch office</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a branch office.</div>
                                    </div>
                                </div>

                                <hr class="my-4">

                                <!-- User Assignment -->
                                <h6 class="fw-semibold mb-3">User Assignment</h6>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="licUser" class="form-label fw-semibold">
                                            LIC User <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="licUser" required disabled>
                                            <option value="">Select LIC user</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a LIC user.</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="assignCoordinator" class="form-label fw-semibold">
                                            Assign to Coordinator <span class="text-danger">*</span>
                                        </label>
                                        <select class="form-select" id="assignCoordinator" required>
                                            <option value="">Select coordinator</option>
                                            <option value="coord1">Sarah Johnson</option>
                                            <option value="coord2">Mike Chen</option>
                                            <option value="coord3">Lisa Patel</option>
                                            <option value="coord4">David Kumar</option>
                                        </select>
                                        <div class="invalid-feedback">Please select a coordinator.</div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="priority" class="form-label fw-semibold">
                                            Priority Level
                                        </label>
                                        <select class="form-select" id="priority">
                                            <option value="normal">Normal</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="dueDate" class="form-label fw-semibold">
                                            Due Date
                                        </label>
                                        <input type="date" class="form-control" id="dueDate">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="specialInstructions" class="form-label fw-semibold">
                                        Special Instructions
                                    </label>
                                    <textarea class="form-control" id="specialInstructions" rows="3" placeholder="Enter any special instructions or notes..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 3: Review -->
                    <div class="step-content d-none" id="step3">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-check-double me-2 text-primary"></i>
                                    Review & Submit
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Please review all the details before submitting the case.
                                </div>

                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-header bg-transparent">
                                                <h6 class="mb-0">Case Information</h6>
                                            </div>
                                            <div class="card-body">
                                                <dl class="row mb-0">
                                                    <dt class="col-sm-5">Case Type:</dt>
                                                    <dd class="col-sm-7" id="summaryCaseType">-</dd>
                                                    <dt class="col-sm-5">Policy Type:</dt>
                                                    <dd class="col-sm-7" id="summaryPolicyType">-</dd>
                                                    <dt class="col-sm-5" id="summaryPolicyNumberLabel">Policy Number:</dt>
                                                    <dd class="col-sm-7" id="summaryPolicyNumber">-</dd>
                                                    <dt class="col-sm-5">Policy Holder:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderName">-</dd>
                                                    <dt class="col-sm-5">Phone:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderPhone">-</dd>
                                                    <dt class="col-sm-5">LIC GST Number:</dt>
                                                    <dd class="col-sm-7" id="summaryLicGstNo">-</dd>
                                                    <dt class="col-sm-5">LIC Type:</dt>
                                                    <dd class="col-sm-7" id="summaryLicType">-</dd>
                                                    <dt class="col-sm-5">Intimation Date:</dt>
                                                    <dd class="col-sm-7" id="summaryIntimationDate">-</dd>
                                                    <dt class="col-sm-5">Date of Birth:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderDob">-</dd>
                                                    <dt class="col-sm-5">Gender:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderGender">-</dd>
                                                    <dt class="col-sm-5">Address:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderAddress">-</dd>
                                                    <dt class="col-sm-5">State:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderState">-</dd>
                                                    <dt class="col-sm-5">City:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderCity">-</dd>
                                                    <dt class="col-sm-5">Pincode:</dt>
                                                    <dd class="col-sm-7" id="summaryHolderPincode">-</dd>
                                                    <dt class="col-sm-5">Proposed Sum Insured:</dt>
                                                    <dd class="col-sm-7" id="summaryProposedSumInsured">-</dd>
                                                    <dt class="col-sm-5">Sum Insured Under Consideration:</dt>
                                                    <dd class="col-sm-7" id="summarySumInsuredUnderConsideration">-</dd>
                                                    <dt class="col-sm-5">Required Tests:</dt>
                                                    <dd class="col-sm-7" id="summaryTests">-</dd>
                                                    <dt class="col-sm-5">Selected Test Details:</dt>
                                                    <dd class="col-sm-7" id="summaryTestPrice">-</dd>
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="card bg-light">
                                            <div class="card-header bg-transparent">
                                                <h6 class="mb-0">Assignment Details</h6>
                                            </div>
                                            <div class="card-body">
                                                <dl class="row mb-0">
                                                    <dt class="col-sm-5">LIC User:</dt>
                                                    <dd class="col-sm-7" id="summaryLicUser">-</dd>
                                                    <dt class="col-sm-5">Coordinator:</dt>
                                                    <dd class="col-sm-7" id="summaryCoordinator">-</dd>
                                                    <dt class="col-sm-5">Priority:</dt>
                                                    <dd class="col-sm-7" id="summaryPriority">-</dd>
                                                    <dt class="col-sm-5">Due Date:</dt>
                                                    <dd class="col-sm-7" id="summaryDueDate">-</dd>
                                                </dl>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <button type="button" class="btn btn-secondary" id="prevBtn" disabled>
                                    <i class="fas fa-arrow-left me-2"></i>Previous
                                </button>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-primary" id="nextBtn">
                                        Next<i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Mobile Menu Toggle -->
    <!-- Updated mobile hamburger button with proper class -->
    <button class="mobile-sidebar-toggle" id="sidebarToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Tests Selection Modal -->
    <div class="modal fade" id="testsModal" tabindex="-1" aria-labelledby="testsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="testsModalLabel">
                        <i class="fas fa-flask me-2 text-primary"></i>
                        Select Required Tests
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-8 mt-2">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-search"></i></span>
                                <input type="text" class="form-control" id="testSearchInput" placeholder="Search tests by name...">
                            </div>
                        </div>
                        <div class="col-md-4 mt-2">
                            <button type="button" class="btn btn-secondary w-100" id="clearAllTests">
                                <i class="fas fa-times me-1"></i>Clear All
                            </button>
                        </div>
                        <div class="col-12 text-center mt-2 mb-2">
                            <button type="button" class="w-100 btn btn-primary confirmTestSelection text-center">
                                <i class="fas fa-check me-2"></i>Confirm Selection
                            </button>
                        </div>
                    </div>
                    
                    <div id="testsContainer" class="row">
                        <div class="col-12 text-center py-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading tests...</span>
                            </div>
                            <p class="mt-3 text-muted">Loading available tests...</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="me-auto">
                        <span class="text-muted">
                            <strong>Selected:</strong> <span id="modalSelectedCount">0</span> tests
                        </span>
                    </div>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary confirmTestSelection">
                        <i class="fas fa-check me-2"></i>Confirm Selection
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/api_caller.js"></script>
    <script src="/static/js/script.js"></script>
    <script src="/static/js/HOD/create-case.js"></script>
    <script src="/static/js/universal-mobile.js"></script>


    <script>
    window.onload = async function () {
        // The view will pass the CSRF token and the correct API URL
        await InitializeCreateCase("{{csrf_token}}", "{% url 'case-api-list' %}", "{% url 'staff-list-api-list' %}", "{% url 'get-test-details-api-list' %}");
    }
</script>
</body>
</html>
